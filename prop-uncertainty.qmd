# Propogating uncertainty

Build function with the process model

## Parameter uncertainity


## Process uncertainty



## Initial condition uncertainty


## Driver uncertainty

```{r}
dates <- seq(as_date("2020-09-30"), as_date("2023-12-01"), by = "1 day")

inputs <- inputs |> 
    filter(datetime %in% dates)

n_members <- 10

X <- array(NA, dim = c(n_members, length(dates), 12))

X[, 1, 1:3] <- unlist(X_init)

out <- NULL

for(ens in 1:n_members){
  X[ens, 1, 1:3] <- unlist(X_init)
  params$alpha <- rnorm(1, mean = 0.02, sd = 0.01)
  for(i in 2:length(dates)){
    X[ens, i, ]  <- SSEM.orig(X[ens, i-1, 1:3], params = params, inputs = inputs[i, ])
  }
  out1 <- as.data.frame(X[ens, , ])
  names(out1) <- c("leaves","wood","SOM", "LAI", "GPP", "NEE", "Ra", "NPPw", "NPPl", "Rh", "litterfall","mortality")
  out1 <- bind_cols(tibble(datetime = dates, ensemble = ens), out1) 
  out <- bind_rows(out, out1)
}

out |> 
  select(datetime,LAI, wood, SOM, NEE, ensemble) |>  
  rename(nee = NEE) |> 
  pivot_longer(-c("datetime", "ensemble"), names_to = "variable", values_to = "prediction") |>
  left_join(obs, by = c("datetime", "variable")) |> 
  filter(variable %in% c("LAI", "wood", "SOM", "nee")) |> 
  ggplot(aes(x = datetime)) +
  geom_point(aes(y = prediction, group = ensemble)) +
  geom_point(aes(y = observation, color = "red")) + 
  facet_wrap(~variable, scale = "free")
```





## Combined uncertainty


## Problem Set

What is the most important driver of uncertainty?

